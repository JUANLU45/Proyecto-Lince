#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# PROYECTO LINCE - PRE-COMMIT HOOK
# VERIFICACIÃ“N COMPLETA ANTES DE COMMIT

echo "ğŸ” Ejecutando verificaciones pre-commit para Proyecto Lince..."

# 1. VERIFICAR LINT
echo "ğŸ“‹ Verificando ESLint..."
npm run lint
if [ $? -ne 0 ]; then
  echo "âŒ ESLint encontrÃ³ errores. Corrige los errores antes de hacer commit."
  exit 1
fi

# 2. VERIFICAR TYPESCRIPT
echo "ğŸ” Verificando TypeScript..."
npm run type-check
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript encontrÃ³ errores. Corrige los errores de tipos antes de hacer commit."
  exit 1
fi

# 3. VERIFICAR FORMATO
echo "ğŸ¨ Verificando formato con Prettier..."
npm run format:check
if [ $? -ne 0 ]; then
  echo "âŒ Archivos no estÃ¡n formateados correctamente. Ejecuta 'npm run format' y vuelve a intentar."
  exit 1
fi

# 4. EJECUTAR TESTS
echo "ğŸ§ª Ejecutando tests..."
npm run test -- --passWithNoTests --watchAll=false --coverage=false
if [ $? -ne 0 ]; then
  echo "âŒ Los tests fallaron. Corrige los tests antes de hacer commit."
  exit 1
fi

# 5. VERIFICAR COMPLEJIDAD DE ARCHIVOS
echo "ğŸ“ Verificando lÃ­mites de complejidad..."
npm run verify:complexity
if [ $? -ne 0 ]; then
  echo "âŒ Algunos archivos exceden los lÃ­mites de complejidad (mÃ¡x 15) o tamaÃ±o (mÃ¡x 300 lÃ­neas)."
  echo "Divide los archivos en componentes mÃ¡s pequeÃ±os antes de hacer commit."
  exit 1
fi

# 6. VERIFICAR ACCESIBILIDAD
echo "â™¿ Verificando accesibilidad..."
npm run verify:a11y
if [ $? -ne 0 ]; then
  echo "âŒ Se encontraron problemas de accesibilidad. Corrige antes de hacer commit."
  exit 1
fi

echo "âœ… Todas las verificaciones pasaron. Procediendo con el commit..."